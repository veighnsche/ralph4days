# Test Fixtures

**Generated test data** for Ralph Loop. Fixtures use `.undetect-ralph/` (not `.ralph/`) so they won't be detected as Ralph projects in the fixtures directory.

## ğŸ”„ Workflow

```
1. Generate fixtures     2. Copy to mock/         3. Test with Ralph
   (test command)           (just reset-mock)        (just dev-mock)

fixtures/                mock/                    Ralph detects
â”œâ”€â”€ empty-project/       â”œâ”€â”€ empty-project/       mock/initialized-project/
â”‚   â””â”€â”€ README.md        â”‚   â””â”€â”€ README.md        â””â”€â”€ .ralph/ âœ“
â””â”€â”€ initialized-project/ â””â”€â”€ initialized-project/
    â”œâ”€â”€ README.md            â”œâ”€â”€ README.md
    â””â”€â”€ .undetect-ralph/     â””â”€â”€ .ralph/ (renamed!)
        â””â”€â”€ db/                  â””â”€â”€ db/
```

## ğŸ“¦ Available Fixtures

### empty-project
**Purpose**: BEFORE state for initialization testing
**Contents**: Just a README (no .undetect-ralph/)
**Use case**: Test `initialize_ralph_project` command
**Can run with dev-mock**: âŒ No (needs initialization first)

### initialized-project
**Purpose**: AFTER state - freshly initialized Ralph project
**Contents**: `.undetect-ralph/` with 1 starter task
**Use case**: Manual testing, monkey testing, smoke tests
**Can run with dev-mock**: âœ… Yes

## ğŸ› ï¸ Generating Fixtures

**IMPORTANT**: Fixtures are **generated by tests**, not manually created!

```bash
# Generate all fixtures
cargo test --manifest-path src-tauri/Cargo.toml --test generate_fixtures generate_all_fixtures -- --nocapture

# Generate specific fixture
cargo test --manifest-path src-tauri/Cargo.toml --test generate_fixtures generate_fixture_initialized_project -- --nocapture
```

This ensures fixtures match the actual output of initialization code (NO REWARD HACKING).

## ğŸ§ª Using Fixtures for Testing

```bash
# 1. Generate fixtures (if not already done)
cargo test --manifest-path src-tauri/Cargo.toml --test generate_fixtures generate_all_fixtures -- --nocapture

# 2. Copy to mock/ and rename .undetect-ralph/ â†’ .ralph/
just reset-mock

# 3. List available mock projects
just list-mock

# 4. Run Ralph with a fixture
just dev-mock initialized-project

# OR use CLI directly
ralph --project mock/initialized-project
```

## ğŸ“ Fixture Structure

All runnable fixtures follow this structure:

```
fixture-name/
â”œâ”€â”€ README.md                      # Fixture documentation
â””â”€â”€ .undetect-ralph/              # Ralph project (undetected in fixtures/)
    â”œâ”€â”€ db/
    â”‚   â”œâ”€â”€ tasks.yaml            # Task list
    â”‚   â”œâ”€â”€ features.yaml         # Feature definitions
    â”‚   â”œâ”€â”€ disciplines.yaml      # Discipline definitions
    â”‚   â””â”€â”€ metadata.yaml         # Project metadata + counters
    â””â”€â”€ CLAUDE.RALPH.md           # Ralph-specific context
```

## ğŸ” Why `.undetect-ralph/`?

- **In `fixtures/`**: Uses `.undetect-ralph/` so Ralph won't detect them as projects
- **In `mock/`**: Renamed to `.ralph/` by `reset-mock.sh` so Ralph can detect them
- **Prevents**: Accidentally running Ralph on fixtures directly
- **Allows**: Clean separation between source (fixtures) and test data (mock)

## ğŸ¯ Mock Directory (Gitignored)

The `mock/` directory is **gitignored** and **disposable**:

```bash
# Reset mock/ from fixtures/
just reset-mock

# Mock gets polluted during testing?
just reset-mock  # Wipe and regenerate

# List what's in mock/
just list-mock
```

## ğŸ”§ Adding New Fixtures

1. **Add a generator function** to `src-tauri/tests/generate_fixtures.rs`:

```rust
#[test]
fn generate_fixture_my_new_fixture() {
    println!("\n=== Generating fixture: my-new-fixture ===");

    let fixture_path = PathBuf::from(env!("CARGO_MANIFEST_DIR"))
        .parent()
        .unwrap()
        .join("fixtures/my-new-fixture");

    // Clean and recreate
    if fixture_path.exists() {
        fs::remove_dir_all(&fixture_path).unwrap();
    }
    fs::create_dir_all(&fixture_path).unwrap();

    // Create README
    fs::write(fixture_path.join("README.md"), "# My Fixture\n...").unwrap();

    // Initialize with .undetect-ralph/
    initialize_project_for_fixture(
        fixture_path.clone(),
        "My Fixture Title".to_string(),
        true, // use .undetect-ralph
    ).unwrap();

    // Add custom tasks, modify files, etc.
    // ...

    println!("âœ“ Created my-new-fixture at: {}", fixture_path.display());
}
```

2. **Add to `generate_all_fixtures()`**:

```rust
#[test]
fn generate_all_fixtures() {
    // ...
    generate_fixture_my_new_fixture();
    // ...
}
```

3. **Generate and commit**:

```bash
# Generate
cargo test --manifest-path src-tauri/Cargo.toml --test generate_fixtures generate_all_fixtures -- --nocapture

# Review
tree fixtures/my-new-fixture -a

# Test
just reset-mock
just dev-mock my-new-fixture

# Commit
git add fixtures/my-new-fixture
git commit -m "Add my-new-fixture"
```

## ğŸ“ Fixture Guidelines

- âœ… **DO**: Generate via test commands
- âœ… **DO**: Use `.undetect-ralph/` in fixtures/
- âœ… **DO**: Include comprehensive README
- âœ… **DO**: Test with `just dev-mock` before committing
- âŒ **DON'T**: Manually create fixtures
- âŒ **DON'T**: Edit fixtures directly (regenerate via tests)
- âŒ **DON'T**: Commit mock/ directory
- âŒ **DON'T**: Use `.ralph/` in fixtures/ (breaks detection logic)

## ğŸ§¹ Maintenance

```bash
# Regenerate all fixtures (if initialization logic changes)
cargo test --manifest-path src-tauri/Cargo.toml --test generate_fixtures generate_all_fixtures -- --nocapture

# Clean mock/
just reset-mock

# Verify fixtures work
just list-mock
for f in mock/*/; do
    echo "Testing $(basename $f)..."
    ralph --project "$f" --help || echo "FAILED"
done
```

## ğŸ¨ Future Fixtures (TODO)

Planned test fixtures to be added via generator functions:

- `multi-task` - Multiple sequential tasks with dependencies
- `parallel-tasks` - Tasks that can run concurrently
- `blocked-task` - Task with dependency blocking
- `complex-feature` - Real-world feature scenario
- `disciplines-custom` - Custom discipline configuration

## ğŸ“š References

- [SPEC-030: Ralph Project Standards](../.specs/030_RALPH_PROJECT_STANDARDS.md)
- Generator: `src-tauri/tests/generate_fixtures.rs`
- Mock script: `scripts/reset-mock.sh`
- Justfile commands: `just reset-mock`, `just dev-mock`, `just list-mock`
